# Прецедент: Снятие наличных

- Акторы: Клиент (primary), Банковская система (supporting)
- Заинтересованные стороны: Клиент, Банк, Инкассатор/обслуживание банкомата

## Предусловия

- Карта вставлена и распознана устройством чтения карт
- Клиент успешно прошёл аутентификацию по PIN (или допускается попытка аутентификации в рамках лимита)
- Соединение с банковской системой доступно
- В банкомате достаточно купюр для выдачи запрашиваемой суммы

## Основной поток

1. Система отображает главное меню.
2. Клиент выбирает пункт «Снять наличные».
3. Система запрашивает у клиента сумму выдачи.
4. Система валидирует сумму (формат, кратность купюрам, положительное значение).
5. Система запрашивает у банковской системы проведение операции списания средств с учетом доступного баланса и суточного лимита.
6. Банковская система подтверждает операцию.
7. Банкомат выдаёт наличные из кассеты.
8. По запросу клиента система печатает чек с деталями операции (сумма, остаток).
9. Клиент возвращается в главное меню или завершает работу.

## Альтернативные потоки/Исключения

- A1: Недостаточно средств на счёте
  - 5a. Банковская система отклоняет операцию; система сообщает о недостаточном остатке и возвращает в меню.
- A2: Превышен суточный лимит
  - 5b. Банковская система отклоняет операцию; система сообщает о превышении лимита и возвращает в меню.
- A3: Недостаточно наличности в банкомате
  - 4a/7a. Система отказывает в выдаче и сообщает о невозможности выполнения операции; возвращает в меню.
- A4: Ошибка связи с банковской системой
  - 5c. Система сообщает об ошибке связи и предлагает повторить позднее, затем возвращает в меню.
- A5: Сессия истекла по таймауту
  - 1a/3a. Если клиент не выполняет действий в течение 60 секунд, система завершает сессию и возвращает карту.
- A6: Неуспешная аутентификация
  - 0a. При превышении лимита попыток ввода PIN (3) карта блокируется/изымается, сессия завершается.

## Постусловия

- При успехе: наличные выданы, средства списаны, баланс уменьшен.
- При отказе: списания не было, карта возвращена при завершении сессии.
- Системный журнал содержит запись о транзакции (успех/отказ и причина).
